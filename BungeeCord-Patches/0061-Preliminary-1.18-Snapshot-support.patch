From 61054d76bc0dec124a59c5adec3628680cc78dff Mon Sep 17 00:00:00 2001
From: LemonCaramel <admin@caramel.moe>
Date: Fri, 17 Sep 2021 03:59:41 +0900
Subject: [PATCH] Preliminary 1.18 Snapshot support


diff --git a/protocol/src/main/java/net/md_5/bungee/protocol/ProtocolConstants.java b/protocol/src/main/java/net/md_5/bungee/protocol/ProtocolConstants.java
index bb37ba04..d609a999 100644
--- a/protocol/src/main/java/net/md_5/bungee/protocol/ProtocolConstants.java
+++ b/protocol/src/main/java/net/md_5/bungee/protocol/ProtocolConstants.java
@@ -36,7 +36,7 @@ public class ProtocolConstants
     public static final int MINECRAFT_1_16_4 = 754;
     public static final int MINECRAFT_1_17 = 755;
     public static final int MINECRAFT_1_17_1 = 756;
-    public static final int MINECRAFT_1_18 = 1073741868;
+    public static final int MINECRAFT_1_18 = (1 << 30) | 48;
     public static final List<String> SUPPORTED_VERSIONS;
     public static final List<Integer> SUPPORTED_VERSION_IDS;
 
@@ -52,7 +52,8 @@ public class ProtocolConstants
                 "1.14.x",
                 "1.15.x",
                 "1.16.x",
-                "1.17.x"
+                "1.17.x",
+                "1.18"
         );
         ImmutableList.Builder<Integer> supportedVersionIds = ImmutableList.<Integer>builder().add(
                 ProtocolConstants.MINECRAFT_1_8,
@@ -83,7 +84,8 @@ public class ProtocolConstants
                 ProtocolConstants.MINECRAFT_1_16_3,
                 ProtocolConstants.MINECRAFT_1_16_4,
                 ProtocolConstants.MINECRAFT_1_17,
-                ProtocolConstants.MINECRAFT_1_17_1
+                ProtocolConstants.MINECRAFT_1_17_1,
+                ProtocolConstants.MINECRAFT_1_18
         );
 
         if ( SNAPSHOT_SUPPORT )
diff --git a/protocol/src/main/java/net/md_5/bungee/protocol/packet/ClientSettings.java b/protocol/src/main/java/net/md_5/bungee/protocol/packet/ClientSettings.java
index 29440533..c8676eb5 100644
--- a/protocol/src/main/java/net/md_5/bungee/protocol/packet/ClientSettings.java
+++ b/protocol/src/main/java/net/md_5/bungee/protocol/packet/ClientSettings.java
@@ -24,6 +24,7 @@ public class ClientSettings extends DefinedPacket
     private byte skinParts;
     private int mainHand;
     private boolean disableTextFiltering;
+    private boolean allowsListing;
 
     @Override
     public void read(ByteBuf buf, ProtocolConstants.Direction direction, int protocolVersion)
@@ -41,6 +42,10 @@ public class ClientSettings extends DefinedPacket
         {
             disableTextFiltering = buf.readBoolean();
         }
+        if ( protocolVersion >= ProtocolConstants.MINECRAFT_1_18 )
+        {
+            allowsListing = buf.readBoolean();
+        }
     }
 
     @Override
@@ -65,6 +70,10 @@ public class ClientSettings extends DefinedPacket
         {
             buf.writeBoolean( disableTextFiltering );
         }
+        if ( protocolVersion >= ProtocolConstants.MINECRAFT_1_18 )
+        {
+            buf.writeBoolean( allowsListing );
+        }
     }
 
     @Override
-- 
2.28.0.windows.1

